<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <script type="text/javascript"
    src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=jo64qrpwlb&submodules=geocoder">
    </script>
  <style>
    #map {
      width: 100%;
      height: 100%;
    }

    body,
    html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script>
    // 전역 객체들을 저장할 네임스페이스
    window.naverMap = null;
    window.markers = {};

    function initMap() {
      console.log("네이버 지도 초기화 시작...");
      try {
        const mapOptions = {
          center: new naver.maps.LatLng(37.5666805, 126.9784147),
          zoom: 14,
          mapTypeId: naver.maps.MapTypeId.NORMAL,
          scaleControl: true,
          logoControl: true,
          mapDataControl: true,
          zoomControl: true,
        };

        // 지도 인스턴스를 전역 변수에 저장
        window.naverMap = new naver.maps.Map('map', mapOptions);
        console.log("네이버 지도 생성 성공");

        // 지도 로드 완료 이벤트
        naver.maps.Event.once(window.naverMap, 'init', function () {
          window.ReactNativeWebView?.postMessage(JSON.stringify({
            type: 'mapInit',
            message: '지도 초기화 완료'
          }));
        });

        // 에러 이벤트 리스너
        naver.maps.Event.addListener(window.naverMap, 'error', function (error) {
          window.ReactNativeWebView?.postMessage(JSON.stringify({
            type: 'error',
            message: error
          }));
        });

        // 클릭 이벤트 리스너
        naver.maps.Event.addListener(window.naverMap, 'click', function (e) {
          window.ReactNativeWebView?.postMessage(JSON.stringify({
            type: 'click',
            data: {
              lat: e.coord.lat(),
              lng: e.coord.lng()
            }
          }));
        });

      } catch (error) {
        window.ReactNativeWebView?.postMessage(JSON.stringify({
          type: 'error',
          message: error.toString()
        }));
      }
    }

    // 페이지 로드 완료 시 초기화
    window.addEventListener('load', initMap);
  </script>
</body>

</html>